---
area: manual
chapter: technical_design
layout: default
---

<h1><a name="5">5. Technical Design</a></h1>

<p class="text-justify">
    This section contains information related to implementation details of
    Joystick Gremlin. This is mainly intended for those that want to get a
    deeper understanding of the internals or extend Joystick Gremlin in some
    way. The following provides an overview of the various components that are
    part of Joystick Gremlin. The components can roughly be split into two
    categories: functional and user interface.
</p>


<h2><a name="5_1">5.1 Input Handling</a></h2>

<p class="text-justify">
    User inputs are captured using <a href="https://www.libsdl.org/">SDL2</a>
    for joystick devices while keyboard and mouse inputs are obtained by
    hooking from Windows' event queue. Both types of events are processed by
    <code>gremlin.event_handler.EventListener</code> which converts the input
    events into Qt signals which other interested parts of Gremlin can be
    connected to. This makes use of the
    <a href="http://doc.qt.io/qt-5/signalsandslots.html">Signal & Slots</a>
    mechanism from Qt.
</p>

<div class="card border-dark mb-3">
    <div class="card-header">
        <h5 class="class-title">Event</h5>
    </div>
    <div class="card-body pb-0">
        <dl class="row">
            <dt class="col-md-4"><code>event_type</code></dt>
            <dd class="col-md-8">The type of the event this represents.</dd>

            <dt class="col-md-4"><code>identifier</code></dt>
            <dd class="col-md-8">The identifier of the event source.</dd>

            <dt class="col-md-4"><code>hardware_id</code></dt>
            <dd class="col-md-8">Hardware ID assigned to the deivce that created the event.</dd>

            <dt class="col-md-4"><code>windows_id</code></dt>
            <dd class="col-md-8">Index assigned by Windows to the device that created the event.</dd>

            <dt class="col-md-4"><code>is_pressed</code></dt>
            <dd class="col-md-8">If the event represents a button or key the value is True for pressed and False for released state.</dd>

            <dt class="col-md-4"><code>value</code></dt>
            <dd class="col-md-8">If the event represents an axis or hat the value contains the state.</dd>
        </dl>
    </div>
</div>


<h2><a name="5_2">5.2 Macro System</a></h2>

<p class="text-justify">
    Each macro consists of a sequence of actions which are executed one
    after the other. Each macro is run in a separate thread in order to
    prevent Joystick Gremlin to become unresponsive.
</p>
<p class="text-justify">
    In order to be provide some control over the execution of macros
    there exists a macro manager which handles the queueing and
    dispatching of macros. This permits some macros to be run in an
    exclusive mode, i.e. only the particular macro can be active and no
    other macro can run during the life time of the exclusive macro.
</p>
<p class="text-justify">
    The various modes in which a macro can be executed, i.e. repeat,
    hold, and toggle, are implemented inside the manager which takes
    care of repeating the macro and terminating it when required.
</p>


<h2><a name="5_3">5.3 Action and Container System</a></h2>

<p class="text-justify">
    Actions and containers work in a similar fashion under the hood and as such
    share quite a few design traits. For each action or container there are
    three different classes, each with their own purpose:
    <ul>
        <li>A data storage class derived from
            <code>gremlin.base_classes.AbstractAction</code> or
            <code>gremlin.base_classes.AbstractCtonainer</code>. This class
            defines the values stored by the action or container and loads them
            from an XML profile and stores them to it as well.</li>
        <li>A UI widget class derived from
            <code>gremlin.ui.input_item.AbstractActionWidget</code> or
            <code>gremlin.ui.input_item.AbstractContainerWidget</code>. This
            class presents the data of the instance to the user and allows
            modifying the contents, storing changes back into the data storage
            class.</li>
        <li>A functor class derived from
            <code>gremlin.base_classes.Functor</code> which implements the
            execution logic of the action or container based on the contents of
            the data class.</li>
    </ul>
</p>

<h4>Interface Definitions</h4>

<p class="text-justify">
    The following presents the interfaces that are inherited from when creating
    a new action or container in order to provide the functionality of the
    three classes outlined above.
</p>

<div class="card border-dark mb-3">
    <div class="card-header">
        <h5 class="class-title">AbstractAction</h5>
    </div>
    <div class="card-body pb-0">
        <dl class="row">
            <dt class="col-md-4"><code>from_xml(node)</code></dt>
            <dd class="col-md-8">Populates the instance based on the XML node's
            content.</dd>

            <dt class="col-md-4"><code>to_xml()</code></dt>
            <dd class="col-md-8">Returns an XML node representing the
            instance's content.</dd>

            <dt class="col-md-4"><code>icon()</code></dt>
            <dd class="col-md-8">Returns the path to the icon indicating this
            action.</dd>

            <dt class="col-md-4"><code>requires_virtual_button()</code></dt>
            <dd class="col-md-8">Returns True if this instance requires a
            virtual button to be used.</dd>
        </dl>
    </div>
</div>

<div class="card border-dark mb-3">
    <div class="card-header">
        <h5 class="class-title">AbstractContainer</h5>
    </div>
    <div class="card-body pb-0">
        <dl class="row">
            <dt class="col-md-4"><code>_parse_xml(node)</code></dt>
            <dd class="col-md-8">Populates the instance based on the XML node's
            content.</dd>

            <dt class="col-md-4"><code>_generate_xml()</code></dt>
            <dd class="col-md-8">Returns an XML node representing the
            instance's content.</dd>

            <dt class="col-md-4"><code>_is_container_valid()</code></dt>
            <dd class="col-md-8">Returns whether or not the contents of the
            container result in a valid setup.</dd>
        </dl>
    </div>
</div>

<div class="card border-dark mb-3">
    <div class="card-header">
        <h5 class="class-title">AbstractActionWidget</h5>
    </div>
    <div class="card-body pb-0">
        <dl class="row">
            <dt class="col-md-4"><code>_create_ui()</code></dt>
            <dd class="col-md-8">Creates all the necessary UI elements to show
            action elements.</dd>

            <dt class="col-md-4"><code>_populate_ui()</code></dt>
            <dd class="col-md-8">Populates the UI elements Creates all the
            necessary UI elements for condition elements.</dd>
        </dl>
    </div>
</div>

<div class="card border-dark mb-3">
    <div class="card-header">
        <h5 class="class-title">AbstractContainerWidget</h5>
    </div>
    <div class="card-body pb-0">
        <dl class="row">
            <dt class="col-md-4"><code>_create_action_ui()</code></dt>
            <dd class="col-md-8">Creates all the necessary UI elements to show
            action elements.</dd>

            <dt class="col-md-4"><code>_create_condition_ui()</code></dt>
            <dd class="col-md-8">Creates all the necessary UI elements for
            condition elements.</dd>

            <dt class="col-md-4"><code>_get_window_title()</code></dt>
            <dd class="col-md-8">Returns the string to use for the window
            title.</dd>
        </dl>
    </div>
</div>

<div class="card border-dark mb-3">
    <div class="card-header">
        <h5 class="class-title">AbstractFunctor</h5>
    </div>
    <div class="card-body pb-0">
        <dl class="row">
            <dt class="col-md-4"><code>process_event(event, value)</code></dt>
            <dd class="col-md-8">Executes the action's or container's logic for
            the provided event and value inputs.</dd>
        </dl>
    </div>
</div>


<h2><a name="5_4">5.4 XML Profile Storage</a></h2>

<p class="text-justify">
    Each profile is stored in a single XML file. The contents of the XML file
    are used to populate the UI as well as generate Python code representing
    the profile. The file is parsed by the <code>gremlin.profile.Profile</code>
    class. Parsing of action or container content is performed by the
    corresponding data storage classes.
</p>
